version: 2.1

orbs:
  python: circleci/python@2.1.1

jobs:
  validate-syntax:
    docker:
      - image: cimg/node:20.0
      - image: cimg/python:3.9
    steps:
      - checkout
      - run:
          name: Validate Python syntax
          command: |
            echo "=== PYTHON SYNTAX VALIDATION ==="
            python_files=$(find . -name "*.py" -type f)
            if [ -z "$python_files" ]; then
              echo "‚ÑπÔ∏è No Python files found"
              exit 0
            fi
            error_found=false
            for file in $python_files; do
              if python -c "import ast; ast.parse(open('$file').read())" 2>/dev/null; then
                echo "‚úÖ $file - Syntax OK"
              else
                echo "‚ùå SYNTAX ERROR in: $file"
                error_found=true
              fi
            done
            if [ "$error_found" = true ]; then
              exit 1
            fi

      - run:
          name: Validate JavaScript syntax
          command: |
            echo "=== JAVASCRIPT SYNTAX VALIDATION ==="
            js_files=$(find . -name "*.js" -type f)
            if [ -z "$js_files" ]; then
              echo "‚ÑπÔ∏è No JavaScript files found"
              exit 0
            fi
            error_found=false
            for file in $js_files; do
              if ! node -c "$file"; then
                echo "‚ùå SYNTAX ERROR in: $file"
                error_found=true
              else
                echo "‚úÖ $file - Syntax OK"
              fi
            done
            if [ "$error_found" = true ]; then
              exit 1
            fi

  run-unit-tests:
    docker:
      - image: cimg/node:20.0
      - image: cimg/python:3.9
    steps:
      - checkout
      - run:
          name: Install dependencies
          command: |
            npm install
            pip install pytest pandas scikit-learn
      - run:
          name: Run Python unit tests
          command: |
            echo "=== PYTHON UNIT TESTS ==="
            python_test_files=$(find . -name "test_*.py" -type f)
            if [ -z "$python_test_files" ]; then
              echo "üö® No Python test files found!"
              exit 1
            fi
            python -m pytest -v --tb=short
      - run:
          name: Run JavaScript unit tests
          command: |
            echo "=== JAVASCRIPT UNIT TESTS ==="
            js_test_files=$(find . -name "test_*.js" -type f)
            if [ -z "$js_test_files" ]; then
              echo "üö® No JavaScript test files found!"
              exit 1
            fi
            for test_file in $js_test_files; do
              node "$test_file"
            done

workflows:
  taboor-ci:
    jobs:
      - validate-syntax
      - run-unit-tests